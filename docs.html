<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ú–µ–∫–µ–º–µ “õ“±–∂–∞—Ç—Ç–∞—Ä—ã ‚Äî –ñ–ú ¬´–ñ–∞–Ω –∂—ã–ª—É—ã¬ª</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/docs-explorer.css">
  <script type="text/javascript">
      // Prevent caching issues by adding timestamp to CSS
      // Helpful during active development
  </script>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <h1>–ñ–ú ¬´–ñ–∞–Ω –∂—ã–ª—É—ã¬ª</h1>
        <p class="subtitle">–º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ “õ“±–∂–∞—Ç—Ç–∞—Ä</p>
      </div>
      <button class="nav-toggle" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">‚ò∞</button>
      <nav class="main-nav">
        <a href="index.html">–ë–∞—Å—Ç—ã –±–µ—Ç</a>
        <a href="events.html">–Ü—Å-—à–∞—Ä–∞–ª–∞—Ä</a>
        <a href="photos.html">–§–æ—Ç–æ—Å—É—Ä–µ—Ç—Ç–µ—Ä</a>
        <a href="docs.html" class="active">–ú–µ–∫–µ–º–µ “õ“±–∂–∞—Ç—Ç–∞—Ä—ã</a>
      </nav>
      <a class="cta" href="index.html">–ê—Ä—Ç“õ–∞</a>
    </div>
  </header>

  <!-- Mobile Overlay -->
  <div class="sidebar-overlay" onclick="toggleSidebar(false)"></div>

  <main class="container">
    
    <!-- Mobile Top Bar -->
    <div class="mobile-header-bar">
        <button class="cta btn-sm" onclick="toggleSidebar(true)">üìÇ –ü–∞–ø–∫–∞–ª–∞—Ä</button>
        <span id="mobileTitle" style="font-weight:600; font-size: 0.9rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">–ë–∞—Å—Ç—ã –±–µ—Ç</span>
    </div>

    <div class="docs-layout">
      <!-- Sidebar -->
      <aside class="sidebar-col">
        <div class="sidebar-header">
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="“ö“±–∂–∞—Ç—Ç—ã —ñ–∑–¥–µ—É...">
          </div>
        </div>
        <div class="doc-tree-container">
          <ul id="docTreeRoot" class="doc-tree"></ul>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="content-col">
        <!-- Breadcrumbs -->
        <div class="breadcrumbs-bar" id="breadcrumbs">
          <span class="crumb-current">–ë–∞—Å—Ç—ã –±–µ—Ç</span>
        </div>

        <!-- View Area -->
        <div id="mainViewArea" class="main-view-area">
           <!-- Content injected via JS -->
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>¬© 2026 –ñ–ú ¬´–ñ–∞–Ω –∂—ã–ª—É—ã¬ª</div>
    </div>
  </footer>

  <script src="js/docs-data.js"></script>
  <script src="js/main.js" defer></script>
  <script>
    /* 
      State Management 
    */
    let appState = {
        view: 'grid', // 'grid' or 'file'
        currentNode: null, // null means root
        path: [] // path to current node
    };

    const treeRootEl = document.getElementById('docTreeRoot');
    const mainViewEl = document.getElementById('mainViewArea');
    const breadcrumbsEl = document.getElementById('breadcrumbs');
    const searchInput = document.getElementById('searchInput');
    const mobileTitle = document.getElementById('mobileTitle');

    // Initial Load
    init();

    function init() {
        if(typeof docsData === 'undefined') return;
        
        // Render Sidebar Tree
        renderSidebarTree(docsData, treeRootEl);
        
        // Render Initial Grid (Root)
        navigateTo(null);

        // Sidebar Search Listener
        searchInput.addEventListener('input', (e) => handleSearch(e.target.value));
    }

    // --- Navigation Logic ---

    function navigateTo(node, parentPath = []) {
        appState.currentNode = node;
        
        // Update Path
        if(node === null) {
            appState.path = [];
        } else {
            appState.path = [...parentPath];
            if(node) appState.path.push(node);
        }

        renderBreadcrumbs();

        if (node && node.type === 'file') {
            appState.view = 'file';
            renderFileViewer(node);
            mobileTitle.textContent = node.name;
        } else {
            appState.view = 'grid';
            renderGridView(node ? node.children : docsData);
            mobileTitle.textContent = node ? node.name : '–ë–∞—Å—Ç—ã –±–µ—Ç';
        }
        
        // Close sidebar on mobile
        toggleSidebar(false);
    }

    // --- Rendering ---

    function renderSidebarTree(nodes, containerElement) {
        containerElement.innerHTML = '';
        nodes.forEach(node => {
            const li = document.createElement('li');
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'tree-item';
            
            // Icon Logic
            let iconStr = 'üìÑ';
            let arrowHtml = '';
            if(node.type === 'folder') {
                iconStr = 'üìÅ';
                arrowHtml = '<span class="arrow">‚ñ∂</span>';
            } else {
                if(node.fileType === 'pdf') iconStr = 'üìï';
                else if(node.fileType === 'excel') iconStr = 'üìó';
                else if(node.fileType === 'word') iconStr = 'üìò';
                else if(node.fileType === 'image') iconStr = 'üñºÔ∏è';
            }

            itemDiv.innerHTML = '<span class="arrow">' + (node.type === 'folder' ? '‚ñ∂' : '') + '</span>' +
                                '<span class="tree-icon">' + iconStr + '</span>' +
                                '<span>' + node.name + '</span>';
            
            // Click Event
            itemDiv.onclick = (e) => {
                e.stopPropagation();
                if(node.type === 'folder') {
                    // Toggle expand in sidebar
                    li.classList.toggle('folder-open');
                    
                    // Navigate only if it's not the current node
                    // But for tree logic, usually we want to see content
                    navigateTo(node, []); // Warning: Breadcrumb limitation in this simple implementation
                } else {
                    navigateTo(node, []);
                }
                
                // Highlight active
                document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
                itemDiv.classList.add('active');
            };

            li.appendChild(itemDiv);

            if(node.children) {
                const ul = document.createElement('ul');
                renderSidebarTree(node.children, ul);
                li.appendChild(ul);
            }
            containerElement.appendChild(li);
        });
    }

    function renderGridView(items) {
        mainViewEl.innerHTML = '';
        const grid = document.createElement('div');
        grid.className = 'grid-view';

        if(!items || items.length === 0) {
           grid.innerHTML = '<p style="color:#888; width:100%; text-align:center; padding-top:2rem;">–ë“±–ª –ø–∞–ø–∫–∞ –±–æ—Å</p>';
           mainViewEl.appendChild(grid);
           return;
        }

        items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'grid-item';
            
            let icon = 'üìÅ';
            let color = '#FFC107'; // Folder yellow
            
            if(item.type !== 'folder') {
                if(item.fileType === 'pdf') { icon = 'üìï'; color = '#F44336'; }
                else if(item.fileType === 'word') { icon = 'üìò'; color = '#2196F3'; }
                else if(item.fileType === 'excel') { icon = 'üìó'; color = '#4CAF50'; }
                else if(item.fileType === 'image') { icon = 'üñºÔ∏è'; color = '#9C27B0'; }
                else { icon = 'üìÑ'; color = '#607D8B'; }
            }

            card.innerHTML = '<div class="grid-icon" style="color:' + color + '">' + icon + '</div><div class="grid-label">' + item.name + '</div>';
            
            card.onclick = () => {
                // When clicking from Grid, we definitely know the path (current path + this item)
                navigateTo(item, appState.path);
            };

            grid.appendChild(card);
        });
        
        mainViewEl.appendChild(grid);
    }

    function renderFileViewer(widthNode) {
        mainViewEl.innerHTML = '';
        
        // Viewer Container
        const encodedPath = widthNode.path.split('/').map(encodeURIComponent).join('/');
        
        if (widthNode.fileType === 'pdf') {
            const iframe = document.createElement('iframe');
            iframe.className = 'doc-viewer-frame';
            iframe.src = encodedPath;
            mainViewEl.appendChild(iframe);
        }
        else if (widthNode.fileType === 'word' || widthNode.fileType === 'excel') {
             // Microsoft Office Viewer
             const fullUrl = new URL(encodedPath, window.location.href).href;
             const viewerUrl = 'https://view.officeapps.live.com/op/embed.aspx?src=' + encodeURIComponent(fullUrl);
             
             const iframe = document.createElement('iframe');
             iframe.className = 'doc-viewer-frame';
             iframe.src = viewerUrl;
             mainViewEl.appendChild(iframe);
        } else {
             // Fallback / Image
             if(widthNode.fileType === 'image') {
                 mainViewEl.innerHTML = '<div style="padding:2rem; text-align:center;"><img src="' + encodedPath + '" style="max-width:100%; height:auto; box-shadow:0 4px 10px rgba(0,0,0,0.1)"></div>';
             } else {
                 mainViewEl.innerHTML = '<div class="download-placeholder" style="margin-top:4rem;"><a href="' + encodedPath + '" class="download-btn" download>üì• –ñ“Ø–∫—Ç–µ–ø –∞–ª—É</a></div>';
             }
        }
    }

    function renderBreadcrumbs() {
        breadcrumbsEl.innerHTML = '';
        
        // Root Link
        const homeSpan = document.createElement('span');
        homeSpan.className = 'crumb-link';
        homeSpan.textContent = 'üè† –ë–∞—Å—Ç—ã –±–µ—Ç';
        homeSpan.onclick = () => navigateTo(null);
        breadcrumbsEl.appendChild(homeSpan);

        appState.path.forEach((node, index) => {
            const sep = document.createElement('span');
            sep.className = 'crumb-sep';
            sep.textContent = ' / ';
            breadcrumbsEl.appendChild(sep);

            const isLast = index === appState.path.length - 1;
            
            const span = document.createElement('span');
            span.textContent = node.name;
            
            if (!isLast) {
                span.className = 'crumb-link';
                const pathUpToHere = appState.path.slice(0, index); // parent path
                span.onclick = () => navigateTo(node, pathUpToHere);
            } else {
                span.className = 'crumb-current';
            }
            breadcrumbsEl.appendChild(span);
        });
    }

    // --- Search ---
    function handleSearch(query) {
        query = query.toLowerCase();
        const allItems = [];
        
        function traverse(nodes) {
            nodes.forEach(n => {
                if(n.name.toLowerCase().includes(query)) {
                    allItems.push(n);
                }
                if(n.children) traverse(n.children);
            });
        }
        
        if(!query) {
            // Restore current view
            navigateTo(appState.currentNode, appState.path.slice(0, -1)); // hacky restore
            return;
        }

        traverse(docsData);
        // Show results in Grid View
        appState.view = 'grid';
        renderGridView(allItems);
        breadcrumbsEl.innerHTML = '<span class="crumb-current">üîç –Ü–∑–¥–µ—É –Ω”ô—Ç–∏–∂–µ—Å—ñ: "' + query + '"</span>';
    }

    // --- Mobile Sidebar ---
    function toggleSidebar(show) {
        const sb = document.querySelector('.sidebar-col');
        const ov = document.querySelector('.sidebar-overlay');
        if(show) {
            sb.classList.add('active');
            ov.classList.add('active');
        } else {
            sb.classList.remove('active');
            ov.classList.remove('active');
        }
    }
  </script>
</body>
</html>
