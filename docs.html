<!doctype html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ú–µ–∫–µ–º–µ “õ“±–∂–∞—Ç—Ç–∞—Ä—ã ‚Äî –ñ–ú ¬´–ñ–∞–Ω –∂—ã–ª—É—ã¬ª</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    :root {
      --sidebar-width: 280px;
    }
    
    .docs-layout {
      position: relative;
      margin-top: 1.5rem;
      min-height: 85vh;
      display: flex;
      gap: 0;
      border: 1px solid #e1e4e8;
      border-radius: 8px;
      overflow: hidden;
      background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    /* === Sidebar Styling === */
    .sidebar-col {
      width: var(--sidebar-width);
      background: #f8f9fa;
      border-right: 1px solid #e1e4e8;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      height: 80vh;
    }

    .sidebar-header {
      padding: 1rem;
      border-bottom: 1px solid #e1e4e8;
      background: #fff;
    }

    .search-box {
      position: relative;
      width: 100%;
    }
    .search-box input {
      width: 100%;
      padding: 0.5rem 0.8rem 0.5rem 2rem;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.9rem;
      outline: none;
      transition: border-color 0.2s;
    }
    .search-box input:focus {
      border-color: var(--primary);
    }
    .search-box::before {
      content: 'üîç';
      position: absolute;
      left: 0.6rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.8rem;
      opacity: 0.5;
    }

    .doc-tree-container {
      flex: 1;
      overflow-y: auto;
      padding: 0.5rem;
    }

    .doc-tree {
      list-style: none;
      padding-left: 0;
    }
    .doc-tree ul {
      padding-left: 1.2rem;
      border-left: 1px solid #ddd;
      margin-left: 0.4rem;
      display: none;
    }
    .doc-tree li {
      margin: 2px 0;
    }
    
    .tree-item {
      display: flex;
      align-items: center;
      padding: 6px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      color: #333;
      text-decoration: none;
      user-select: none;
    }
    .tree-item:hover {
      background: #e9ecef;
    }
    .tree-item.active {
      background: #e3f2fd;
      color: var(--primary);
      font-weight: 500;
    }
    .tree-icon {
      margin-right: 8px;
      width: 16px;
      text-align: center;
    }
    .folder-open > ul {
      display: block;
    }
    .arrow {
        font-size: 0.7em;
        margin-right: 5px;
        color: #888;
        transition: transform 0.2s;
    }
    .folder-open > .tree-item .arrow {
        transform: rotate(90deg);
    }

    /* === Main Content Area === */
    .content-col {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #fff;
      height: 80vh;
      overflow: hidden;
    }

    /* Breadcrumbs */
    .breadcrumbs-bar {
      padding: 0.8rem 1rem;
      border-bottom: 1px solid #e1e4e8;
      background: #fff;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
      color: #666;
      white-space: nowrap;
      overflow-x: auto;
    }
    .crumb-link {
        color: #0366d6;
        text-decoration: none;
        cursor: pointer;
    }
    .crumb-link:hover { text-decoration: underline; }
    .crumb-sep { color: #ccc; }
    .crumb-current { color: #333; font-weight: 500; }

    /* Viewer / Grid Area */
    .main-view-area {
      flex: 1;
      overflow-y: auto;
      padding: 0; /* Viewer handles its own padding */
      position: relative;
    }

    /* Grid View (Explorer Style) */
    .grid-view {
      padding: 1.5rem;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 1.5rem;
    }
    
    .grid-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      cursor: pointer;
      padding: 1rem;
      border-radius: 8px;
      transition: background 0.2s;
    }
    .grid-item:hover {
      background: #f0f4f8;
    }
    .grid-icon {
      font-size: 3rem;
      margin-bottom: 0.5rem;
    }
    .grid-label {
      font-size: 0.9rem;
      color: #333;
      word-break: break-word;
      line-height: 1.3;
      max-width: 100%;
    }

    /* Document Viewer */
    .doc-viewer-frame {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    .docx-container {
        padding: 2rem;
        background: #f4f4f4;
        min-height: 100%;
    }

    /* Responsive */
    .mobile-header-bar {
        display: none; /* Desktop default */
    }

    @media (max-width: 768px) {
      .docs-layout {
        flex-direction: column;
        border: none;
        box-shadow: none;
        margin-top: 0;
        height: auto;
      }
      .sidebar-col {
        display: none; /* Hidden by default on mobile */
        position: fixed;
        z-index: 1000;
        top: 0; left: 0; bottom: 0;
        width: 80%;
        box-shadow: 2px 0 10px rgba(0,0,0,0.2);
      }
      .sidebar-col.active {
        display: flex;
      }
      .content-col {
        height: auto; /* Allow scroll on mobile */
        min-height: 80vh;
      }
      .mobile-header-bar {
        display: flex;
        align-items: center;
        padding: 0.8rem;
        background: #f8f9fa;
        border-bottom: 1px solid #ddd;
        gap: 1rem;
      }
      .breadcrumbs-bar {
        padding: 0.5rem;
        font-size: 0.8rem;
        overflow-x: auto;
      }
      
      /* Mobile Overlay */
      .sidebar-overlay {
        display: none;
        position: fixed;
        top:0; left:0; right:0; bottom:0;
        background: rgba(0,0,0,0.5);
        z-index: 999;
      }
      .sidebar-overlay.active { display: block; }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <h1>–ñ–ú ¬´–ñ–∞–Ω –∂—ã–ª—É—ã¬ª</h1>
        <p class="subtitle">–º–µ–º–ª–µ–∫–µ—Ç—Ç—ñ–∫ “õ“±–∂–∞—Ç—Ç–∞—Ä</p>
      </div>
      <button class="nav-toggle" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è">‚ò∞</button>
      <nav class="main-nav">
        <a href="index.html">–ë–∞—Å—Ç—ã –±–µ—Ç</a>
        <a href="events.html">–ú–µ—Ä–µ–∫–µ–ª—ñ–∫ —ñ—Å-—à–∞—Ä–∞–ª–∞—Ä</a>
        <a href="docs.html" class="active">–ú–µ–∫–µ–º–µ “õ“±–∂–∞—Ç—Ç–∞—Ä—ã</a>
      </nav>
      <a class="cta" href="index.html">–ê—Ä—Ç“õ–∞</a>
    </div>
  </header>

  <!-- Mobile Overlay -->
  <div class="sidebar-overlay" onclick="toggleSidebar(false)"></div>

  <main class="container">
    
    <!-- Mobile Top Bar -->
    <div class="mobile-header-bar">
        <button class="cta btn-sm" onclick="toggleSidebar(true)">üìÇ –ü–∞–ø–∫–∞–ª–∞—Ä</button>
        <span id="mobileTitle" style="font-weight:600; font-size: 0.9rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">–ë–∞—Å—Ç—ã –±–µ—Ç</span>
    </div>

    <div class="docs-layout">
      <!-- Sidebar -->
      <aside class="sidebar-col">
        <div class="sidebar-header">
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="“ö“±–∂–∞—Ç—Ç—ã —ñ–∑–¥–µ—É...">
          </div>
        </div>
        <div class="doc-tree-container">
          <ul id="docTreeRoot" class="doc-tree"></ul>
        </div>
      </aside>

      <!-- Main Content -->
      <div class="content-col">
        <!-- Breadcrumbs -->
        <div class="breadcrumbs-bar" id="breadcrumbs">
          <span class="crumb-current">–ë–∞—Å—Ç—ã –±–µ—Ç</span>
        </div>

        <!-- View Area -->
        <div id="mainViewArea" class="main-view-area">
           <!-- Content injected via JS: either Grid or Viewer -->
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div>¬© 2024 –ñ–ú ¬´–ñ–∞–Ω –∂—ã–ª—É—ã¬ª</div>
    </div>
  </footer>

  <script src="js/docs-data.js"></script>
  <script src="js/main.js" defer></script>
  <script>
    /* 
      State Management 
      currentFolder: object (if viewing grid)
      currentFile: object (if viewing file)
      pathStack: array of nodes for breadcrumbs
    */
    let appState = {
        view: 'grid', // 'grid' or 'file'
        currentNode: null, // null means root
        path: [] // path to current node
    };

    const treeRootEl = document.getElementById('docTreeRoot');
    const mainViewEl = document.getElementById('mainViewArea');
    const breadcrumbsEl = document.getElementById('breadcrumbs');
    const searchInput = document.getElementById('searchInput');
    const mobileTitle = document.getElementById('mobileTitle');

    // Initial Load
    init();

    function init() {
        if(typeof docsData === 'undefined') return;
        
        // Render Sidebar Tree
        renderSidebarTree(docsData, treeRootEl);
        
        // Render Initial Grid (Root)
        navigateTo(null);

        // Sidebar Search Listener
        searchInput.addEventListener('input', (e) => handleSearch(e.target.value));
    }

    // --- Navigation Logic ---

    function navigateTo(node, parentPath = []) {
        appState.currentNode = node;
        
        // Update Path
        if(node === null) {
            appState.path = [];
        } else {
            // Recalculate path based on traversal or just push if simple drill down?
            // Simpler: assume we have the full path or reconstruct it.
            // For now, let's keep it simple: Breadcrumbs are rebuilt on selection.
            appState.path = [...parentPath];
            if(node) appState.path.push(node);
        }

        renderBreadcrumbs();

        if (node && node.type === 'file') {
            appState.view = 'file';
            renderFileViewer(node);
            mobileTitle.textContent = node.name;
        } else {
            appState.view = 'grid';
            renderGridView(node ? node.children : docsData);
            mobileTitle.textContent = node ? node.name : '–ë–∞—Å—Ç—ã –±–µ—Ç';
        }
        
        // Close sidebar on mobile
        toggleSidebar(false);
    }

    // --- Rendering ---

    function renderSidebarTree(nodes, containerElement) {
        containerElement.innerHTML = '';
        nodes.forEach(node => {
            const li = document.createElement('li');
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'tree-item';
            
            // Icon Logic
            let iconStr = 'üìÑ';
            let arrowHtml = '';
            if(node.type === 'folder') {
                iconStr = 'üìÅ';
                arrowHtml = '<span class="arrow">‚ñ∂</span>';
            } else {
                if(node.fileType === 'pdf') iconStr = 'üìï';
                else if(node.fileType === 'excel') iconStr = 'üìó';
                else if(node.fileType === 'word') iconStr = 'üìò';
                else if(node.fileType === 'image') iconStr = 'üñºÔ∏è';
            }

            itemDiv.innerHTML = `${arrowHtml}<span class="tree-icon">${iconStr}</span><span>${node.name}</span>`;
            
            // Click Event
            itemDiv.onclick = (e) => {
                e.stopPropagation();
                if(node.type === 'folder') {
                    // Toggle expand in sidebar
                    li.classList.toggle('folder-open');
                    // Also navigate in main view
                    // We need a way to know the logical path to this node. 
                    // For sidebar clicks, we might need to search the tree or pass path.
                    // Simplified: We just update the Grid View, breadcrumb path is harder here without back-ref.
                    // Hack: We navigate to it, setting it as current. 
                    // Breadcrumb reconstruction is non-trivial without parent refs.
                    // For this version, let's just update the view.
                    navigateTo(node, []); // Warning: Breadcrumb might break if deep linking from tree. 
                } else {
                    navigateTo(node, []); // Same warning.
                }
                
                // Highlight active
                document.querySelectorAll('.tree-item').forEach(el => el.classList.remove('active'));
                itemDiv.classList.add('active');
            };

            li.appendChild(itemDiv);

            if(node.children) {
                const ul = document.createElement('ul');
                renderSidebarTree(node.children, ul);
                li.appendChild(ul);
            }
            containerElement.appendChild(li);
        });
    }

    function renderGridView(items) {
        mainViewEl.innerHTML = '';
        const grid = document.createElement('div');
        grid.className = 'grid-view';

        if(!items || items.length === 0) {
           grid.innerHTML = '<p style="color:#888; width:100%; text-align:center;">–ë“±–ª –ø–∞–ø–∫–∞ –±–æ—Å</p>';
           mainViewEl.appendChild(grid);
           return;
        }

        items.forEach(item => {
            const card = document.createElement('div');
            card.className = 'grid-item';
            
            let icon = 'üìÅ';
            let color = '#FFC107'; // Folder yellow
            
            if(item.type !== 'folder') {
                if(item.fileType === 'pdf') { icon = 'üìï'; color = '#F44336'; }
                else if(item.fileType === 'word') { icon = 'üìò'; color = '#2196F3'; }
                else if(item.fileType === 'excel') { icon = 'üìó'; color = '#4CAF50'; }
                else if(item.fileType === 'image') { icon = 'üñºÔ∏è'; color = '#9C27B0'; }
                else { icon = 'üìÑ'; color = '#607D8B'; }
            }

            card.innerHTML = `<div class="grid-icon" style="color:${color}">${icon}</div><div class="grid-label">${item.name}</div>`;
            
            card.onclick = () => {
                // When clicking from Grid, we definitely know the path (current path + this item)
                navigateTo(item, appState.path);
            };

            grid.appendChild(card);
        });
        
        mainViewEl.appendChild(grid);
    }

    function renderFileViewer(widthNode) {
        mainViewEl.innerHTML = '';
        
        // Viewer Container
        const encodedPath = widthNode.path.split('/').map(encodeURIComponent).join('/');
        
        if (widthNode.fileType === 'pdf') {
            const iframe = document.createElement('iframe');
            iframe.className = 'doc-viewer-frame';
            iframe.src = encodedPath;
            mainViewEl.appendChild(iframe);
        }
        else if (widthNode.fileType === 'word' || widthNode.fileType === 'excel') {
             // Microsoft Office Viewer
             const fullUrl = new URL(encodedPath, window.location.href).href;
             const viewerUrl = 'https://view.officeapps.live.com/op/embed.aspx?src=' + encodeURIComponent(fullUrl);
             
             const iframe = document.createElement('iframe');
             iframe.className = 'doc-viewer-frame';
             iframe.src = viewerUrl;
             mainViewEl.appendChild(iframe);
        } else {
             // Fallback / Image
             if(widthNode.fileType === 'image') {
                 mainViewEl.innerHTML = `<div style="padding:2rem; text-align:center;"><img src="${encodedPath}" style="max-width:100%; height:auto; box-shadow:0 4px 10px rgba(0,0,0,0.1)"></div>`;
             } else {
                 mainViewEl.innerHTML = `<div class="download-placeholder" style="margin-top:4rem;"><a href="${encodedPath}" class="download-btn" download>üì• –ñ“Ø–∫—Ç–µ–ø –∞–ª—É</a></div>`;
             }
        }
    }

    function renderBreadcrumbs() {
        breadcrumbsEl.innerHTML = '';
        
        // Root Link
        const homeSpan = document.createElement('span');
        homeSpan.className = 'crumb-link';
        homeSpan.textContent = 'üè† –ë–∞—Å—Ç—ã –±–µ—Ç';
        homeSpan.onclick = () => navigateTo(null);
        breadcrumbsEl.appendChild(homeSpan);

        appState.path.forEach((node, index) => {
            const sep = document.createElement('span');
            sep.className = 'crumb-sep';
            sep.textContent = ' / ';
            breadcrumbsEl.appendChild(sep);

            const isLast = index === appState.path.length - 1;
            
            const span = document.createElement('span');
            span.textContent = node.name;
            
            if (!isLast) {
                span.className = 'crumb-link';
                // To navigate back to this node, we need the path up to this node.
                // Slice path from 0 to index+1 not valid here because we need the references.
                // Actually we can just slice the current path array.
                const pathUpToHere = appState.path.slice(0, index); // parent path
                
                // Wait, navigateTo expects (node, parentPath). 
                // We want to navigate TO this node, so parent is pathUpToHere.
                // BUT navigateTo pushes the node to the path.
                // So if we pass (node, pathUpToHere), results in [...pathUpToHere, node] which is correct.
                
                span.onclick = () => navigateTo(node, pathUpToHere);
            } else {
                span.className = 'crumb-current';
            }
            breadcrumbsEl.appendChild(span);
        });
    }

    // --- Search ---
    function handleSearch(query) {
        query = query.toLowerCase();
        const allItems = [];
        
        function traverse(nodes) {
            nodes.forEach(n => {
                if(n.name.toLowerCase().includes(query)) {
                    allItems.push(n);
                }
                if(n.children) traverse(n.children);
            });
        }
        
        if(!query) {
            // Restore current view
            navigateTo(appState.currentNode, appState.path.slice(0, -1)); // hacky restore
            return;
        }

        traverse(docsData);
        // Show results in Grid View
        appState.view = 'grid';
        renderGridView(allItems);
        breadcrumbsEl.innerHTML = '<span class="crumb-current">üîç –Ü–∑–¥–µ—É –Ω”ô—Ç–∏–∂–µ—Å—ñ: "' + query + '"</span>';
    }

    // --- Mobile Sidebar ---
    function toggleSidebar(show) {
        const sb = document.querySelector('.sidebar-col');
        const ov = document.querySelector('.sidebar-overlay');
        if(show) {
            sb.classList.add('active');
            ov.classList.add('active');
        } else {
            sb.classList.remove('active');
            ov.classList.remove('active');
        }
    }
  </script>
</body>
</html>
